!function(){var t={};function n(t=null){this.identifiers={},this.parent=t}n.prototype={define:function(t,n){Object.defineProperty(this.identifiers,t,{get:function(){return n},set:function(){throw new Error(`Cannot update ${t}. It is a constant value.`)}})},initialize:function(t,n){const e=typeof n;let r=n;Object.defineProperty(this.identifiers,t,{get:function(){return r},set:function(n){if(typeof n!==e)throw new Error(`Cannot assign '${n}' to '${t}'. New value type must be '${e}'`);r=n}})},read:function(t){if(void 0!==this.identifiers[t])return this.identifiers[t];if(null!==this.parent)return this.parent.read(t);throw new Error(`Cannot read variable '${t}'. It has not been created.`)},update:function(t,n){if(void 0!==this.identifiers[t])this.identifiers[t]=n;else{if(null===this.parent)throw new Error(`Cannot update variable '${t}'. It has not been created.`);this.parent.update(t,n)}},new:function(){return n.new(this)},getIdentifiers:function(){return Object.keys(this.identifiers)}},n.new=function(t){return new n(t)},t=n;var e;function r(){}function o(){const t=new r;return Object.freeze(t)}function i(){this.dictionary={}}function s(t){return t.split("\n").map(t=>"    "+t).join("\n")}function u(t,n,e){if("number"!=typeof n||"number"!=typeof e)throw new Error(`All values provided to ${t} must be numbers; values received are: ${n} of type ${typeof n} and ${e} of type ${typeof e}`)}r.prototype={toString:()=>"nil"},i.prototype={getSafeKey:function(t){if("string"!=typeof t)throw new Error("Dictionary keys can only be strings.");return t.toLowerCase()},keys:function(){return Object.keys(this.dictionary)},hasKey:function(t){const n=this.getSafeKey(t);return void 0!==this.dictionary[n]},read:function(t){const n=this.getSafeKey(t);return void 0!==this.dictionary[n]?this.dictionary[n]:o()},remove:function(t){const n=this.getSafeKey(t);this.dictionary[n]=void 0,delete this.dictionary[n]},set:function(t,n){const e=this.getSafeKey(t);return this.dictionary[e]=n,this},toString:function(){let t=Object.keys(this.dictionary).map(t=>(value="string"==typeof this.dictionary[t]?`"${this.dictionary[t]}"`:this.dictionary[t].toString(),1===value.split("\n").length?s(`${t}: ${value}`):s(`${t}: \n${s(value)}`)));return["Dictionary {"].concat(t).concat(["}"]).join("\n")}},e=function(t){return{newArray:function(...t){return t},appendTo:function(t,n){if(!Array.isArray(t))throw new Error("Append can only add values to an array.");return t.push(n),t},newDictionary:function(){return new i},hasKey:function(t,n){if(!t instanceof i)throw new Error("Keys can only be accessed on a dictionary.");return t.hasKey(n)},getKeysFrom:function(t){if(!t instanceof i)throw new Error("Keys can only be accessed on a dictionary.");return t.keys()},readFrom:function(t,n){if(t instanceof i){const e=n.toLowerCase();return t.read(e)}if(Array.isArray(t)){const e=parseInt(n)-1;return void 0!==t[e]?t[e]:o()}throw new Error("Read can only be used on dictionaries and arrays.")},removeFrom:function(t,n){if(t instanceof i){const e=n.remove(n);return t.read(e)}if(Array.isArray(t)){const e=parseInt(n);return t.splice(e,1),t}throw new Error("Remove can only be used on dictionaries and arrays.")},setOn:function(t,n,e){if(!t instanceof i)throw new Error("Values may only be set on a dictionary.");return t.set(n.toLowerCase(),e),t},isNil:function(t){return t instanceof r},Nil:function(){return o()},print:function(...t){t.forEach((function(t){"object"==typeof window&&"function"==typeof window.print?window.print(t):console.log(t)}))},prompt:function(n){if("object"==typeof window){const t=prompt(n);return null===t?"":t.trim()}return t()(n).trim()},join:function(...t){return t.join("")},toLowerCase:function(t){return t.toLowerCase()},toUpperCase:function(t){return t.toUpperCase()},toArray:function(t,n=""){return t.split(n)},getCharacterAtIndex:function(t,n){if("string"!=typeof t)throw new Error(`Cannot read characters from a non-string value. Got ${t} of type ${typeof t}.`);return t[n-1]},lengthOf:function(t){return t.length},not:function(t){if("boolean"!=typeof t)throw new Error(`Cannot apply 'not' function to non-boolean values. Got value ${t} of type ${typeof t}`);return!t},random:function(t=0,n=1){u("random",t,n);const e=(t>=n?t+Math.abs(n):n)-t;return Math.random()*e+t},absoluteValue:function(t){return Math.abs(t)},floor:function(t){return Math.floor(t)},ceiling:function(t){return Math.ceil(t)},squareRoot:function(t){return Math.sqrt(t)},power:function(t,n){return u("power",t,n),Math.pow(t,n)},maximum:function(t,n){return u("maximum",t,n),t>n?t:n},minimum:function(t,n){return u("minimum",t,n),t<n?t:n},remainder:function(t,n){return u("modulus",t,n),t%n},round:function(t,n){u("round",t,n);const e=Math.pow(10,n);return Math.round(t*e)/e},log:function(t,n=Math.E){return u("log",t,n),Math.log(t)/Math.log(n)}}};const c=["true","false"],a=["be","as","to","with","while"],f=["loop","repeat","if","else"],l=["::","toInfix"],p={operators:["+","-","*","/"],openGroupDelimiter:"(",closeGroupDelimiter:")",functionExecutionIndicator:":",stringBeginIndicator:'"',stringEndIndicator:'"',stringEscapeCharacter:"\\",commentCharacter:"#",whitespaceCharacter:"s",subtractionToken:"-"},h=["isGreaterThan","isLessThan","isGreaterOrEqualTo","isLessOrEqualTo","isEqualTo"].map(t=>t.toLowerCase()),y={Number:t=>/^\-?[0-9]+(\.[0-9]+)?$/.test(t),Boolean:t=>c.includes(t.toLowerCase()),String:t=>t[0]===p.stringBeginIndicator&&t[t.length-1]===p.stringEndIndicator,InfixOperator:t=>l.includes(t),Operator:t=>p.operators.concat(["and","or"]).concat(h).includes(t),FunctionExecutionIndicator:t=>t===p.functionExecutionIndicator,OpenGroupDelimiter:t=>t===p.openGroupDelimiter,CloseGroupDelimiter:t=>t===p.closeGroupDelimiter,OpenBlockDelimiter:t=>"begin"===t.toLowerCase(),CloseBlockDelimiter:t=>"end"===t.toLowerCase(),TransitionalOperator:t=>a.includes(t.toLowerCase()),CallOperator:t=>"call"===t.toLowerCase(),ControlOperator:t=>f.includes(t.toLowerCase()),Identifier:()=>!0},d=Object.keys(y).map(t=>({type:t,test:y[t]}));var w={grammarTypes:Object.keys(y).reduce((function(t,n){return t["is"+n]=y[n],t}),{}),tokenTypes:Object.keys(y).reduce((function(t,n){return t[n]=n,t}),{}),getTokenType:function(t){const n=d.filter(n=>n.test(t)).map(t=>t.type)[0];if(void 0===n)throw new Error("Unknown value or symbol in source code: "+t);return n},characterSet:p};const g=w.tokenTypes,{stringBeginIndicator:m,stringEndIndicator:b,stringEscapeCharacter:k,commentCharacter:v,whitespaceCharacter:$,subtractionToken:S}=w.characterSet;function E(t){return/[\s\t]/.test(t)}function x(t){let n="",e=0;for(let r=0;r<t.length;r++){const o=t[r];if(o===k)n+=t[r+1],r++;else{if(o===b){e=r+1;break}n+=o}e=r}return[n,e]}function C(t,n){const e=t.split(""),r=[];let o;const i=function(t){return function(n,e){if(""!==n){const r=n[0]===m?n:n.toLowerCase();t.push(function(t,n){return{line:n,token:t,type:w.getTokenType(t)}}(r,e))}}}(r),s=()=>o="",u=()=>{i(o,n),s()};s();for(let c=0;c<e.length;c++){const t=e[c];if(t===v)break;if(":"===t&&":"===e[c+1])u(),o="::",c++,u();else if(w.grammarTypes.isOperator(t)||w.grammarTypes.isOpenGroupDelimiter(t)||w.grammarTypes.isCloseGroupDelimiter(t)||w.grammarTypes.isFunctionExecutionIndicator(t)){u(),o=t;const n=r[r.length-1];t===S&&n.type!==g.Number&&n.type!==g.CloseGroupDelimiter||u()}else if(t===m){u();const[t,n]=x(e.slice(c+1));o=`${m}${t}${b}`,u(),c+=n}else E(t)&&""!==o?u():E(t)||(o+=t)}return u(),r}var O=function(t){const n=t.split(/\r?\n/),e=[];for(let r=0;r<n.length;r++){const t=C(n[r],r+1);t.length>0&&e.push(t)}return e},T={};function I(t){this.type="BinaryExpression",this.operator=t}const j={"+":(t,n)=>t+n,"-":(t,n)=>t-n,"*":(t,n)=>t*n,"/":(t,n)=>t/n},A={and:(t,n)=>t&&n,or:(t,n)=>t||n};function B(t,n){return function(e,r){if("number"!=typeof e||"number"!=typeof r)throw new Error(`Cannot compare non-number values with ${t} operator.`);return n(e,r)}}const L={isgreaterghan:B("isGreaterThan",(t,n)=>t>n),islessthan:B("isLessThan",(t,n)=>t<n),isgreaterorequalto:B("isGreaterOrEqualTo",(t,n)=>!(t<n)),islessorequalto:B("isLessOrEqualTo",(t,n)=>!(t>n)),isequalto:(t,n)=>t===n};I.prototype={setLeft:function(t){this.left=t},setRight:function(t){this.right=t},toString:function(){return`${this.left.toString()} ${this.operator} ${this.right.toString()}`},execute:function(t){const n=this.left.execute(t),e=this.right.execute(t);return Object.keys(j).includes(this.operator)?function(t,n,e){if("number"!=typeof n||"number"!=typeof e)throw new Error(`Arithmetic operations can only be run on numbers. Received ${n} of type ${typeof n} && ${e} of type ${typeof e}.`);return j[t](n,e)}(this.operator,n,e):Object.keys(L).includes(this.operator)?(r=this.operator,o=n,i=e,L[r](o,i)):function(t,n,e){return A[t](n,e)}(this.operator,n,e);var r,o,i}},I.new=function(t){return new I(t)},T=I;var G=function(t,n){return n.split("\n").map(n=>t+n).join("\n")},D={};function M(t,n){this.type="Conditional",this.blockType=t,this.condition=n,this.success=[],this.fail=null}M.prototype={setSuccess:function(t){this.success=Array.isArray(t)?t:[]},setFail:function(t){null===this.fail?this.fail=t:this.fail.setFail(t)},toString:function(){const t=`${blockType} ${"else"!==blockType?this.condition.toString():""}`,n=this.success.map(t=>G("    ",t.toString()));let e=[t].concat(n);return null!==this.fail&&e.concat(this.fail.toString()),"if"===this.blockType&&e.concat("end"),e.join("\n")},execute:function(t){const n=t.new();if(this.condition.execute(n))for(let e=0;e<this.success.length;e++)this.success[e].execute(n);else null!==this.fail&&this.fail.execute(t)}},M.new=function(t,n){return new M(t,n)},D=M;var K={};function q(t){this.type="FunctionCall",this.name=t,this.arguments=[]}q.prototype={addArguments:function(t){this.arguments=t},toString:function(){const t=this.arguments.map(t=>t.toString());return[this.name+":"].concat(t).join(" ")},execute:function(t){const n=t.read(this.name);if("function"!=typeof n)throw new Error(`Cannot call ${this.name}, it is not a function.`);{const e=this.arguments.map(n=>n.execute(t));return n.apply(null,e)}}},q.new=function(t){return new q(t)},K=q;var F={};function N(){this.type="Group",this.body}N.prototype={setBody:function(t){this.body=t},toString:function(){return`(${this.body.toString()})`},execute:function(t){return this.body.execute(t)}},N.new=function(){return new N},F=N;var P={};function R(t){this.type="Identifier",this.name=t}R.prototype={toString:function(){return this.name},execute:function(t){return t.read(this.name)}},R.new=function(t){return new R(t)},P=R;var U={};function z(t,n,e){this.type="InitializationExpression",this.variableType=t,this.identifier=n,this.value=e}z.prototype={toString:function(){return"let"===this.variableType?`let ${this.identifier.toString()} be ${this.value.toString()}`:`define ${this.identifier.toString()} as ${this.value.toString()}`},execute:function(t){const n=this.value.execute(t);return"let"===this.variableType?t.initialize(this.identifier.name,n):t.define(this.identifier.name,n),n}},z.new=function(t,n,e){return new z(t,n,e)},U=z;var V={};function H(t){this.type="Literal",this.value=function(t){switch(t.type){case"String":return t.token.replace(/^\"(.*)\"$/,"$1");case"Number":return Number(t.token);case"Boolean":return"true"===t.token;default:return null}}(t)}H.prototype={toString:function(){return"string"==typeof this.value?`"${this.value}"`:this.value.toString()},execute:function(){return this.value}},H.new=function(t){return new H(t)},V=H;var J={};function Q(t){this.type="Loop",this.condition=t,this.body=[]}Q.prototype={setBody:function(t){this.body=t},toString:function(){const t="loop while "+this.condition.toString(),n=this.body.map(t=>G("    ",t.toString()));return[t].concat(n).concat(["end"]).join("\n")},execute:function(t){const n=t.new();for(;this.condition.execute(n);){const t=n.new();for(let n=0;n<this.body.length;n++)this.body[n].execute(t)}}},Q.new=function(t){return new Q(t)},J=Q;var W={};function X(t){this.type="Program",this.body=t}X.prototype={addBodyNode:function(t){this.body.push(t)},toString:function(){const t=this.body.map(t=>G("    ",t.toString()));return["begin"].concat(t).concat("end").join("\n")},execute:function(t){this.body.forEach((function(n){n.execute(t)}))}},X.new=function(t){return new X(t)},W=X;var Y={};function Z(t,n){this.type="UpdateExpression",this.identifier=t,this.value=n}function _(t,n){return t.splice(0,n),t}function tt(t){return t.map(t=>Array.isArray(t)?t[0].token.toString():t.token.toString()).join(" ")}function nt(t){return t.splice(0,1)[0]}function et(t,n){const e=it(_(t,2).slice(0)),r=J.new(e),o=rt(n);return r.setBody(o),r}function rt(t){const n=[];for(;t.length>0&&"end"!==t[0][0].token;){const r=nt(t);let o;if("if"===r[0].token){const n=it(_(r,1).slice(0)),e=D.new("if",n),i=rt(t);let s,u;e.setSuccess(i);do{if(u=(s="else"===t[0][0].token)&&1===t[0].length,s){const n=u?"else":"else if";let r;u?r=V.new({type:"Boolean",token:"true"}):(_(t[0],2),r=it(t[0]));const o=D.new(n,r),i=rt(_(t,1));o.setSuccess(i),e.setFail(o)}if(u)break}while(s);o=e}else{if("else"===r[0].token)return t.unshift(r),n;o="loop"!==(e=r)[0].token&&"repeat"!==e[0].token||"while"!==e[1].token?it(r.slice(0)):et(r,t)}n.push(o)}var e;if(0===t.length)throw new Error('Incomplete program: an "end" declaration is missing.');return _(t,1),n}Z.prototype={toString:function(){return`update ${this.identifier.toString()} to ${this.value.toString()}`},execute:function(t){const n=this.value.execute(t);return t.update(this.identifier.name,n),n}},Z.new=function(t,n){return new Z(t,n)},Y=Z;const ot=[[function(t){return t.length>2&&(ct([t[0]])||at([t[0]]))&&function(t){return"Operator"===t[0].type}([t[1]])},function(t){const n=T.new(t[1].token);if(n.setLeft(it([t[0]])),["and","*","/"].includes(t[1].token)){let e;if(ct([t[2]])||at([t[2]]))e=t[2],_(t,3);else{if(!ft([t[2]]))throw new Error("Arithmetic expression contains an error: ",tt(t));lt(_(t,2)),e=t[0],_(t,1)}n.setRight(it([e]));const r=function(t){return{type:"ParsedBinaryExpression",token:t}}(n);return t.unshift(r),it(t)}return n.setRight(it(_(t,2))),n}],[ct,function(t){return ut.includes(t[0].type)?t[0].token:V.new(t[0])}],[ft,lt],[at,function(t){return P.new(t[0].token)}],[function(t){return t.length>3&&("let"===t[0].token&&"be"===t[2].token||"define"===t[0].token&&"as"===t[2].token)},function(t){const n=t[0].token,e=P.new(t[1].token),r=it(_(t,3));return U.new(n,e,r)}],[function(t){return t.length>3&&"update"===t[0].token&&"to"===t[2].token},function(t){const n=P.new(t[1].token),e=it(_(t,3));return Y.new(n,e)}],[function(t){return t.length>2&&"Identifier"===t[0].type&&"FunctionExecutionIndicator"===t[1].type||"CallOperator"===t[0].type||"InfixOperator"===t[0].type},function(t){if("CallOperator"===t[0].type)_(t,1);else if("InfixOperator"===t[0].type){const n=t[0],e=t[2],r=t[1];t[0]=e,t[1]=n,t[2]=r}const n=K.new(t[0].token),e=it(_(t,2)),r=Array.isArray(e)?e:[e].filter(t=>Boolean(t));return n.addArguments(r),n}]];function it(t){if(0===t.length)return;const n=ot.find(n=>n[0](t));if(function(t){return"CloseGroupDelimiter"===t[0].type}(t))_(t,1);else{if(Boolean(n))return n[1](t);if(t.length>1&&"operator"!==t[0].type){const n=it([t[0]]);if(_(t,1),"operator"===t[0].type)return n;{const e=it(t);return Boolean(e)?[n].concat(e):n}}!function(t){const n=Boolean(t[0].line)?t[0].line:"unknown line";throw new Error(`Unable to interpret this program, an error exists at line ${n} near "${tt(t)}"`)}(t)}}const st=["Number","Boolean","String"],ut=["ParsedTokenSet","ParsedBinaryExpression"];function ct(t){return 1===t.length&&(st.includes(t[0].type)||ut.includes(t[0].type))}function at(t){return 1===t.length&&"Identifier"===t[0].type}function ft(t){return"OpenGroupDelimiter"===t[0].type}function lt(t){const n=F.new(),e=it(_(t,1));if(!Boolean(e)||Array.isArray(e))throw new Error(`Unparseable group in source: "${tt(t)}"`);n.setBody(e);const r={type:"ParsedTokenSet",token:n};return t.unshift(r),it(t)}var pt=function(t){const n=rt(t.slice(1));return W.new(n)},ht=function(n,r){const o=function(n){const r=t.new(),o=e(n);return Object.keys(o).forEach((function(t){r.define(t.toLowerCase(),o[t])})),r}(r);(function(t){const n=O(t);return pt(n)})(n).execute(o)};"object"==typeof window&&(window.loadAndRunProgram=ht)}();